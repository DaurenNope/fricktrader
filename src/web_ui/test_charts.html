<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            background: #0f172a; 
            color: white; 
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .chart-container { 
            width: 800px; 
            height: 400px; 
            background: #1e293b; 
            border-radius: 12px; 
            padding: 20px;
            margin: 20px 0;
        }
        h2 { color: #60a5fa; }
        .status { 
            padding: 10px; 
            background: #334155; 
            border-radius: 8px; 
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>🚀 Trading Dashboard Chart Test</h1>
    
    <div class="status" id="status">
        Loading chart data...
    </div>
    
    <h2>📈 Price Chart</h2>
    <div class="chart-container">
        <canvas id="priceChart" style="width: 100%; height: 100%;"></canvas>
    </div>
    
    <h2>💰 Portfolio Performance</h2>
    <div class="chart-container">
        <canvas id="portfolioChart" style="width: 100%; height: 100%;"></canvas>
    </div>
    
    <script>
        // Test the chart functionality
        async function testCharts() {
            try {
                document.getElementById('status').innerHTML = '🔄 Fetching market data...';
                
                // Fetch real market data
                const response = await fetch('/api/market-data/BTC/USDT');
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                document.getElementById('status').innerHTML = `✅ Data loaded for ${data.pair} - Price: $${data.price_data.current_price.toLocaleString()}`;
                
                // Create price chart
                const priceCtx = document.getElementById('priceChart').getContext('2d');
                new Chart(priceCtx, {
                    type: 'line',
                    data: {
                        labels: data.chart_data.labels,
                        datasets: [{
                            label: 'BTC/USDT Price',
                            data: data.chart_data.prices,
                            borderColor: '#667eea',
                            backgroundColor: '#667eea20',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, labels: { color: '#e2e8f0' } }
                        },
                        scales: {
                            x: { 
                                ticks: { color: '#94a3b8' },
                                grid: { color: '#334155' }
                            },
                            y: { 
                                ticks: { 
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                },
                                grid: { color: '#334155' }
                            }
                        }
                    }
                });
                
                // Create portfolio chart with demo data
                const portfolioCtx = document.getElementById('portfolioChart').getContext('2d');
                const portfolioLabels = [];
                const portfolioValues = [];
                const baseValue = 1000;
                
                for (let i = 0; i < 30; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - (29 - i));
                    portfolioLabels.push(date.toLocaleDateString());
                    portfolioValues.push(baseValue + Math.random() * 200 - 100 + i * 2);
                }
                
                new Chart(portfolioCtx, {
                    type: 'line',
                    data: {
                        labels: portfolioLabels,
                        datasets: [{
                            label: 'Portfolio Value',
                            data: portfolioValues,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, labels: { color: '#e2e8f0' } }
                        },
                        scales: {
                            x: { 
                                ticks: { color: '#94a3b8' },
                                grid: { color: '#334155' }
                            },
                            y: { 
                                ticks: { 
                                    color: '#94a3b8',
                                    callback: function(value) {
                                        return '$' + value.toFixed(2);
                                    }
                                },
                                grid: { color: '#334155' }
                            }
                        }
                    }
                });
                
                console.log('✅ Charts rendered successfully');
                
            } catch (error) {
                console.error('❌ Chart test failed:', error);
                document.getElementById('status').innerHTML = `❌ Error: ${error.message}`;
            }
        }
        
        // Run test when page loads
        document.addEventListener('DOMContentLoaded', testCharts);
    </script>
</body>
</html>