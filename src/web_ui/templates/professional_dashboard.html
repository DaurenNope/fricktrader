<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Crypto Trading Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --danger-gradient: linear-gradient(135deg, #ff6b6b 0%, #ffa502 100%);
            --dark-gradient: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
        }
        
        .dark-bg {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        .dark-card {
            background-color: #1e293b;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .dark-card-hover { 
            transition: all 0.3s ease;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .dark-card-hover:hover { 
            transform: translateY(-4px); 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .gradient-bg { background: var(--primary-gradient); }
        .success-gradient { background: var(--success-gradient); }
        .warning-gradient { background: var(--warning-gradient); }
        .danger-gradient { background: var(--danger-gradient); }
        .dark-gradient { background: var(--dark-gradient); }
        
        .pulse-green { animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .status-indicator { 
            width: 10px; 
            height: 10px; 
            border-radius: 50%; 
            display: inline-block; 
            margin-right: 8px;
        }
        
        .status-live { 
            background-color: #10b981; 
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }
        
        .status-offline { background-color: #ef4444; }
        
        .timeframe-btn { 
            transition: all 0.2s ease;
            border-radius: 8px;
            font-weight: 500;
            background-color: #334155;
            color: #cbd5e1;
            border: 1px solid #475569;
        }
        
        .timeframe-btn.active { 
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-color: transparent;
        }
        
        .pattern-badge { 
            font-size: 0.7rem; 
            padding: 3px 8px; 
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .pattern-bullish { 
            background: linear-gradient(135deg, #10b981, #059669); 
            color: #ecfdf5; 
        }
        
        .pattern-bearish { 
            background: linear-gradient(135deg, #ef4444, #dc2626); 
            color: #fef2f2; 
        }
        
        .pattern-neutral { 
            background: linear-gradient(135deg, #64748b, #475569); 
            color: #f1f5f9; 
        }
        
        .metric-card {
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
            background-color: #1e293b;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }
        
        .btn-primary {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .btn-secondary {
            background: #334155;
            border: 1px solid #475569;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #475569;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .chart-container {
            border-radius: 16px;
            overflow: hidden;
            background: #1e293b;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f1f5f9;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #60a5fa;
        }
        
        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .data-table th {
            background: #334155;
            font-weight: 600;
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid #475569;
        }
        
        .data-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #334155;
        }
        
        .data-table tr:last-child td {
            border-bottom: none;
        }
        
        .data-table tr:hover td {
            background: #334155;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #334155;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .symbol-tag {
            background: #334155;
            border-radius: 20px;
            padding: 6px 14px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #475569;
        }
        
        .symbol-tag:hover {
            background: #475569;
            transform: translateY(-1px);
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            border-radius: 12px;
            background: #1e293b;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #94a3b8;
        }
        
        .empty-state h3 {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 0.5rem;
        }
        
        .empty-state p {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .crypto-only {
            color: #f1f5f9;
        }
        
        .crypto-only::after {
            content: " (Crypto Only)";
            color: #94a3b8;
            font-size: 0.8rem;
            font-weight: normal;
        }
    </style>
</head>
<body class="dark-bg font-sans">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-xl">
        <div class="container mx-auto px-6 py-5">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                <div class="flex items-center space-x-4">
                    <div class="bg-white bg-opacity-20 p-3 rounded-xl">
                        <i class="fas fa-chart-line text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Professional Crypto Trading Dashboard</h1>
                        <div class="flex items-center mt-1">
                            <span class="status-indicator status-live"></span>
                            <span class="text-sm opacity-90">Live Crypto Market Data</span>
                            <span class="mx-2">â€¢</span>
                            <span class="text-sm opacity-90" id="lastUpdateHeader">Last updated: Never</span>
                        </div>
                    </div>
                </div>
                <div class="flex flex-wrap items-center gap-3">
                    <button onclick="toggleAutoRefresh()" id="autoRefreshBtn" 
                            class="btn-secondary flex items-center gap-2">
                        <i class="fas fa-sync-alt"></i>
                        <span>Auto Refresh: ON</span>
                    </button>
                    <a href="/enhanced-trading-history" 
                       class="btn-secondary flex items-center gap-2">
                        <i class="fas fa-brain"></i>
                        <span>Trade Logic</span>
                    </a>
                    <a href="/trading-history" 
                       class="btn-secondary flex items-center gap-2">
                        <i class="fas fa-history"></i>
                        <span>Trading History</span>
                    </a>
                    <a href="http://127.0.0.1:8080" target="_blank" 
                       class="btn-primary flex items-center gap-2">
                        <i class="fas fa-external-link-alt"></i>
                        <span>Freqtrade UI</span>
                    </a>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <div class="container mx-auto px-6 py-8">
        
        <!-- Symbol Selection & Timeframes -->
        <div class="dark-card rounded-2xl shadow-xl p-6 mb-8 dark-card-hover">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-6 lg:space-y-0">
                
                <!-- Symbol Input -->
                <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                    <div class="relative w-full sm:w-80">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                        <input type="text" id="symbolInput" placeholder="Enter crypto pair (BTC/USDT, ETH/USDT, etc.)" 
                               value="BTC/USDT" 
                               class="w-full pl-10 pr-24 py-3 bg-slate-800 border border-slate-700 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all text-white">
                        <button onclick="analyzeSymbol()" 
                                class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-4 py-1.5 rounded-lg transition-all font-medium">
                            Analyze
                        </button>
                    </div>
                    <div class="flex items-center text-sm text-gray-300 bg-slate-800 px-4 py-2 rounded-lg">
                        <i class="far fa-clock mr-2"></i>
                        <span id="lastUpdate">Last updated: Never</span>
                    </div>
                </div>
                
                <!-- Timeframe Selection -->
                <div class="flex flex-wrap items-center gap-3">
                    <span class="text-sm font-medium text-gray-300 hidden sm:block">Timeframe:</span>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="setTimeframe('1m')" class="timeframe-btn px-4 py-2 text-sm">1m</button>
                        <button onclick="setTimeframe('5m')" class="timeframe-btn px-4 py-2 text-sm">5m</button>
                        <button onclick="setTimeframe('15m')" class="timeframe-btn px-4 py-2 text-sm">15m</button>
                        <button onclick="setTimeframe('1h')" class="timeframe-btn px-4 py-2 text-sm active">1h</button>
                        <button onclick="setTimeframe('4h')" class="timeframe-btn px-4 py-2 text-sm">4h</button>
                        <button onclick="setTimeframe('1d')" class="timeframe-btn px-4 py-2 text-sm">1d</button>
                    </div>
                </div>
            </div>
            
            <!-- Quick Symbols -->
            <div class="mt-6 pt-6 border-t border-slate-700">
                <p class="text-sm font-medium text-gray-300 mb-3">Popular Crypto Pairs:</p>
                <div class="flex flex-wrap gap-2">
                    <span onclick="quickAnalyze('BTC/USDT')" class="symbol-tag">BTC/USDT</span>
                    <span onclick="quickAnalyze('ETH/USDT')" class="symbol-tag">ETH/USDT</span>
                    <span onclick="quickAnalyze('SOL/USDT')" class="symbol-tag">SOL/USDT</span>
                    <span onclick="quickAnalyze('BNB/USDT')" class="symbol-tag">BNB/USDT</span>
                    <span onclick="quickAnalyze('XRP/USDT')" class="symbol-tag">XRP/USDT</span>
                    <span onclick="quickAnalyze('ADA/USDT')" class="symbol-tag">ADA/USDT</span>
                </div>
            </div>
        </div>

        <!-- Key Metrics Row -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            
            <!-- Smart Money Signal -->
            <div class="metric-card dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <i class="fas fa-fire text-orange-500"></i>
                            <p class="text-sm font-medium text-gray-400">Smart Money Signal</p>
                        </div>
                        <p class="text-2xl font-bold mt-2 text-white" id="smartMoneySignal">LOADING...</p>
                        <p class="text-xs text-gray-400 mt-1" id="smartMoneyConfidence">Analyzing market data...</p>
                    </div>
                    <div class="bg-orange-900 bg-opacity-30 p-3 rounded-xl">
                        <i class="fas fa-fire text-2xl text-orange-500"></i>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-400">Confidence</span>
                        <span class="font-medium text-white" id="smartMoneyConfidenceValue">0%</span>
                    </div>
                    <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-orange-400 to-orange-600 h-2 rounded-full" id="smartMoneyConfidenceBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Pattern Count -->
            <div class="metric-card dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <i class="fas fa-chart-line text-blue-500"></i>
                            <p class="text-sm font-medium text-gray-400">Chart Patterns</p>
                        </div>
                        <p class="text-2xl font-bold mt-2 text-white" id="patternCount">0</p>
                        <p class="text-xs text-gray-400 mt-1" id="patternBreakdown">0 Bullish, 0 Bearish</p>
                    </div>
                    <div class="bg-blue-900 bg-opacity-30 p-3 rounded-xl">
                        <i class="fas fa-chart-line text-2xl text-blue-500"></i>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <div class="flex items-center justify-between text-xs mb-2">
                        <span class="text-gray-400">Bullish</span>
                        <span class="font-medium text-green-400" id="bullishPatternCount">0</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full" id="bullishPatternBar" style="width: 0%"></div>
                    </div>
                    <div class="flex items-center justify-between text-xs mt-2">
                        <span class="text-gray-400">Bearish</span>
                        <span class="font-medium text-red-400" id="bearishPatternCount">0</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2 mt-1">
                        <div class="bg-gradient-to-r from-red-400 to-red-600 h-2 rounded-full" id="bearishPatternBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <!-- Multi-Signal Score -->
            <div class="metric-card dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <i class="fas fa-bullseye text-purple-500"></i>
                            <p class="text-sm font-medium text-gray-400">Multi-Signal Score</p>
                        </div>
                        <p class="text-2xl font-bold mt-2 text-white" id="multiSignalScore">0.000</p>
                        <p class="text-xs text-gray-400 mt-1" id="signalBreakdown">Tech + OnChain + Sentiment</p>
                    </div>
                    <div class="bg-purple-900 bg-opacity-30 p-3 rounded-xl">
                        <i class="fas fa-bullseye text-2xl text-purple-500"></i>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <div class="flex items-center justify-between text-xs mb-2">
                        <span class="text-gray-400">Signal Strength</span>
                        <span class="font-medium text-white" id="signalStrengthValue">0%</span>
                    </div>
                    <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-purple-400 to-purple-600 h-2 rounded-full" id="signalStrengthBar" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-xs mt-3 text-gray-500">
                        <span>Weak</span>
                        <span>Strong</span>
                    </div>
                </div>
            </div>
            
            <!-- Active Trades -->
            <div class="metric-card dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <i class="fas fa-wallet text-green-500"></i>
                            <p class="text-sm font-medium text-gray-400">Active Trades</p>
                        </div>
                        <p class="text-2xl font-bold mt-2 text-white" id="activeTradesCount">0</p>
                        <p class="text-xs text-gray-400 mt-1" id="tradesProfit">$0.00 P&L</p>
                    </div>
                    <div class="bg-green-900 bg-opacity-30 p-3 rounded-xl">
                        <i class="fas fa-wallet text-2xl text-green-500"></i>
                    </div>
                </div>
                <div class="mt-4 pt-4 border-t border-slate-700">
                    <div class="flex items-center justify-between text-xs mb-2">
                        <span class="text-gray-400">Profitability</span>
                        <span class="font-medium text-white" id="profitabilityValue">0%</span>
                    </div>
                    <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                        <div class="bg-gradient-to-r from-green-400 to-green-600 h-2 rounded-full" id="profitabilityBar" style="width: 50%"></div>
                    </div>
                    <div class="flex justify-between text-xs mt-3 text-gray-500">
                        <span>Loss</span>
                        <span>Profit</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Left Column - Chart & Patterns -->
            <div class="lg:col-span-2 space-y-8">
                
                <!-- Price Chart -->
                <div class="chart-container dark-card-hover">
                    <div class="p-6">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                            <h3 class="section-title">
                                <i class="fas fa-chart-bar"></i>
                                <span class="crypto-only">Price Chart</span>
                            </h3>
                            <div class="flex flex-wrap items-center gap-4">
                                <div class="flex items-center gap-2 bg-slate-800 px-3 py-1.5 rounded-lg">
                                    <span class="text-sm text-gray-400">Current Price:</span>
                                    <span class="text-lg font-bold text-white" id="currentPrice">$0.00</span>
                                    <span class="text-sm font-medium text-green-400" id="priceChange">+0.00%</span>
                                </div>
                                <div class="flex gap-1">
                                    <button onclick="setChartTimeframe('1D')" class="chart-timeframe-btn px-3 py-1.5 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg transition-all">1D</button>
                                    <button onclick="setChartTimeframe('1W')" class="chart-timeframe-btn px-3 py-1.5 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg transition-all">1W</button>
                                    <button onclick="setChartTimeframe('1M')" class="chart-timeframe-btn px-3 py-1.5 text-sm bg-slate-800 hover:bg-slate-700 rounded-lg transition-all">1M</button>
                                    <button onclick="setChartTimeframe('All')" class="chart-timeframe-btn px-3 py-1.5 text-sm bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg active">All</button>
                                </div>
                            </div>
                        </div>
                        <div id="priceChart" style="height: 450px;" class="rounded-xl bg-slate-800">
                            <!-- TradingView Widget -->
                            <div id="tradingview_widget" style="height:100%;width:100%"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Advanced Patterns -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                        <h3 class="section-title">
                            <i class="fas fa-search"></i>
                            <span class="crypto-only">Advanced Chart Patterns</span>
                        </h3>
                        <div class="flex gap-2">
                            <button onclick="filterPatterns('all')" class="timeframe-btn px-4 py-2 text-sm active">All</button>
                            <button onclick="filterPatterns('bullish')" class="timeframe-btn px-4 py-2 text-sm">Bullish</button>
                            <button onclick="filterPatterns('bearish')" class="timeframe-btn px-4 py-2 text-sm">Bearish</button>
                        </div>
                    </div>
                    <div id="advancedPatterns" class="space-y-4">
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>Loading Advanced Patterns</h3>
                            <p>Analyzing chart patterns for trading opportunities</p>
                        </div>
                    </div>
                </div>
                
                <!-- Smart Money Screener -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
                        <h3 class="section-title">
                            <i class="fas fa-gem"></i>
                            <span class="crypto-only">Smart Money Screener</span>
                        </h3>
                        <button onclick="runScreener()" class="btn-primary flex items-center gap-2 px-6 py-2.5">
                            <i class="fas fa-bolt"></i>
                            <span>Run Screener</span>
                        </button>
                    </div>
                    <div id="smartMoneyScreener" class="space-y-4">
                        <div class="empty-state">
                            <i class="fas fa-gem"></i>
                            <h3>Smart Money Opportunities</h3>
                            <p>Click "Run Screener" to discover top trading opportunities</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Data & Analysis -->
            <div class="space-y-8">
                
                <!-- Smart Money Analysis -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <h3 class="section-title mb-6">
                        <i class="fas fa-fire"></i>
                        <span class="crypto-only">Smart Money Analysis</span>
                    </h3>
                    <div id="smartMoneyAnalysis" class="space-y-5">
                        <div class="empty-state">
                            <i class="fas fa-fire"></i>
                            <h3>Loading Smart Money Data</h3>
                            <p>Analyzing institutional and whale activity</p>
                        </div>
                    </div>
                </div>
                
                <!-- Market Data -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <h3 class="section-title mb-6">
                        <i class="fas fa-database"></i>
                        <span class="crypto-only">Market Data</span>
                    </h3>
                    <div id="marketData" class="space-y-4">
                        <div class="empty-state">
                            <i class="fas fa-database"></i>
                            <h3>Loading Market Data</h3>
                            <p>Gathering comprehensive market analysis</p>
                        </div>
                    </div>
                </div>
                
                <!-- Active Trades -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="section-title mb-0">
                            <i class="fas fa-wallet"></i>
                            <span class="crypto-only">Active Trades</span>
                        </h3>
                        <div class="relative">
                            <span class="text-sm text-gray-400" id="tradeCountBadge">0 trades</span>
                        </div>
                    </div>
                    <div id="activeTradesDetail" class="space-y-4">
                        <div class="empty-state">
                            <i class="fas fa-wallet"></i>
                            <h3>No Active Trades</h3>
                            <p>Waiting for trading signals to execute</p>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Signals -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <h3 class="section-title mb-6">
                        <i class="fas fa-bolt"></i>
                        <span class="crypto-only">Recent Signals</span>
                    </h3>
                    <div id="recentSignals" class="space-y-3">
                        <div class="empty-state">
                            <i class="fas fa-bolt"></i>
                            <h3>No Recent Signals</h3>
                            <p>Waiting for strategy signals to generate</p>
                        </div>
                    </div>
                </div>
                
                <!-- Trade Logic Display -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <h3 class="section-title mb-6">
                        <i class="fas fa-brain"></i>
                        <span class="crypto-only">Trade Logic & Reasoning</span>
                    </h3>
                    <div id="tradeLogic" class="space-y-5">
                        <div class="empty-state">
                            <i class="fas fa-brain"></i>
                            <h3>Loading Trade Logic</h3>
                            <p>Analyzing decision-making process</p>
                        </div>
                    </div>
                </div>
                
                <!-- Social Sentiment & Trader Following -->
                <div class="dark-card rounded-2xl shadow-xl p-6 dark-card-hover">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="section-title mb-0">
                            <i class="fas fa-users"></i>
                            <span class="crypto-only">Social Sentiment</span>
                        </h3>
                        <button onclick="refreshSocialSentiment()" class="btn-secondary flex items-center gap-2 px-3 py-1.5 text-sm">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh</span>
                        </button>
                    </div>
                    
                    <!-- Sentiment Overview -->
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-400 mb-1">Twitter Sentiment</p>
                            <p class="text-lg font-bold text-white" id="twitterSentiment">0%</p>
                            <div class="w-full bg-slate-700 rounded-full h-1 mt-2">
                                <div class="bg-blue-400 h-1 rounded-full" id="twitterSentimentBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-400 mb-1">Reddit Sentiment</p>
                            <p class="text-lg font-bold text-white" id="redditSentiment">0%</p>
                            <div class="w-full bg-slate-700 rounded-full h-1 mt-2">
                                <div class="bg-orange-400 h-1 rounded-full" id="redditSentimentBar" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="bg-slate-800 rounded-lg p-3 text-center">
                            <p class="text-xs text-gray-400 mb-1">Overall Sentiment</p>
                            <p class="text-lg font-bold text-white" id="overallSentiment">0%</p>
                            <div class="w-full bg-slate-700 rounded-full h-1 mt-2">
                                <div class="bg-green-400 h-1 rounded-full" id="overallSentimentBar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Followed Traders -->
                    <div class="border-t border-slate-700 pt-4">
                        <h4 class="font-medium text-white mb-3 flex items-center gap-2">
                            <i class="fas fa-star text-yellow-400"></i>
                            Followed Traders
                        </h4>
                        <div id="followedTraders" class="space-y-3">
                            <div class="empty-state">
                                <i class="fas fa-user-plus"></i>
                                <h3>No Traders Followed</h3>
                                <p>Add traders to follow their sentiment and signals</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentSymbol = 'BTC/USDT';
        let currentTimeframe = '1h';
        let autoRefresh = true;
        let refreshInterval;
        let priceChart;
        
        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸš€ Professional Crypto Trading Dashboard Loading...');
            
            // Initialize components
            initializeChart();
            loadAllData();
            
            // Set up auto-refresh
            setupAutoRefresh();
            
            // Update last update time
            updateLastUpdateTime();
        });
        
        // Initialize chart
        function initializeChart() {
            try {
                const chartContainer = document.getElementById('priceChart');
                if (!chartContainer) {
                    console.error('Chart container not found');
                    return;
                }
                
                // Clear container
                chartContainer.innerHTML = '';
                
                // Create chart
                priceChart = LightweightCharts.createChart(chartContainer, {
                    width: chartContainer.clientWidth,
                    height: 450,
                    layout: {
                        backgroundColor: '#1e293b',
                        textColor: '#e2e8f0',
                    },
                    grid: {
                        vertLines: {
                            color: '#334155',
                        },
                        horzLines: {
                            color: '#334155',
                        },
                    },
                    timeScale: {
                        timeVisible: true,
                        secondsVisible: false,
                        borderColor: '#475569',
                    },
                    crosshair: {
                        mode: LightweightCharts.CrosshairMode.Normal,
                    },
                    rightPriceScale: {
                        borderColor: '#475569',
                        textColor: '#e2e8f0',
                    },
                });
                
                // Create candlestick series
                const candleSeries = priceChart.addCandlestickSeries({
                    upColor: '#10b981',
                    downColor: '#ef4444',
                    borderDownColor: '#ef4444',
                    borderUpColor: '#10b981',
                    wickDownColor: 'rgba(239, 68, 68, 0.5)',
                    wickUpColor: 'rgba(16, 185, 129, 0.5)',
                });
                
                // Create volume series
                const volumeSeries = priceChart.addHistogramSeries({
                    color: '#3b82f6',
                    priceFormat: {
                        type: 'volume',
                    },
                    priceScaleId: '',
                    scaleMargins: {
                        top: 0.8,
                        bottom: 0,
                    },
                });
                
                // Load real chart data
                loadChartData();
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (priceChart) {
                        priceChart.applyOptions({
                            width: chartContainer.clientWidth
                        });
                    }
                });
                
                console.log('âœ… Price chart initialized successfully');
            } catch (error) {
                console.error('Error initializing chart:', error);
                document.getElementById('priceChart').innerHTML = `
                    <div class="flex items-center justify-center h-full bg-slate-800 rounded-xl">
                        <div class="text-center text-gray-400">
                            <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                            <div class="font-medium text-lg">Chart Initialization Error</div>
                            <div class="text-sm mt-1">Unable to initialize chart. Please refresh the page.</div>
                            <button onclick="initializeChart()" class="mt-4 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg text-sm">
                                <i class="fas fa-redo mr-2"></i>Retry
                            </button>
                        </div>
                    </div>
                `;
            }
        }
        
        // Load chart data
        function loadChartData() {
            // Show loading indicator
            const chartContainer = document.getElementById('priceChart');
            if (chartContainer && !chartContainer.querySelector('.loading-indicator')) {
                chartContainer.innerHTML = `
                    <div class="flex items-center justify-center h-full bg-slate-800 rounded-xl loading-indicator">
                        <div class="text-center">
                            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                            <p class="text-gray-400">Loading chart data for ${currentSymbol}...</p>
                        </div>
                    </div>
                `;
            }
            
            // Fetch chart data from our API
            fetch(`/api/chart-data/${currentSymbol}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data && data.length > 0) {
                        // Update current price and change
                        const lastCandle = data[data.length - 1];
                        const prevCandle = data[data.length - 2];
                        const currentPrice = lastCandle.close;
                        const priceChange = prevCandle ? ((currentPrice - prevCandle.close) / prevCandle.close) * 100 : 0;
                        
                        document.getElementById('currentPrice').textContent = `$${currentPrice.toFixed(2)}`;
                        document.getElementById('priceChange').textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
                        document.getElementById('priceChange').className = `text-sm font-medium ${priceChange >= 0 ? 'text-green-400' : 'text-red-400'}`;
                        
                        // Separate candles and volumes
                        const candles = data.map(d => ({
                            time: d.time / 1000, // Convert from milliseconds to seconds
                            open: d.open,
                            high: d.high,
                            low: d.low,
                            close: d.close
                        }));
                        
                        const volumes = data.map(d => ({
                            time: d.time / 1000, // Convert from milliseconds to seconds
                            value: d.volume,
                            color: d.close >= d.open ? 'rgba(16, 185, 129, 0.5)' : 'rgba(239, 68, 68, 0.5)'
                        }));
                        
                        // Update chart series
                        if (priceChart) {
                            const series = priceChart.serieses();
                            if (series.length >= 2) {
                                series[0].setData(candles);
                                series[1].setData(volumes);
                            }
                        }
                    } else {
                        // Show no data message
                        document.getElementById('priceChart').innerHTML = `
                            <div class="flex items-center justify-center h-full bg-slate-800 rounded-xl">
                                <div class="text-center text-gray-400">
                                    <i class="fas fa-chart-bar text-4xl mb-3"></i>
                                    <div class="font-medium text-lg">No Chart Data Available</div>
                                    <div class="text-sm mt-1">Waiting for data to populate...</div>
                                </div>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Error loading chart data:', error);
                    // Show error message
                    document.getElementById('priceChart').innerHTML = `
                        <div class="flex items-center justify-center h-full bg-slate-800 rounded-xl">
                            <div class="text-center text-gray-400">
                                <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                                <div class="font-medium text-lg">Chart Data Error</div>
                                <div class="text-sm mt-1">Failed to load chart data: ${error.message}</div>
                                <button onclick="loadChartData()" class="mt-4 px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg text-sm">
                                    <i class="fas fa-redo mr-2"></i>Retry
                                </button>
                            </div>
                        </div>
                    `;
                });
        }
        
        // Load all data
        function loadAllData() {
            loadSmartMoneyAnalysis();
            loadAdvancedPatterns();
            loadMarketData();
            loadActiveTrades();
            loadRecentSignals();
            loadTradeLogic();
            loadChartData();
        }
        
        // Set up auto-refresh
        function setupAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            
            if (autoRefresh) {
                refreshInterval = setInterval(function() {
                    loadAllData();
                    updateLastUpdateTime();
                }, 30000); // Refresh every 30 seconds
            }
        }
        
        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = document.getElementById('autoRefreshBtn');
            
            if (autoRefresh) {
                btn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Auto Refresh: ON</span>';
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
                setupAutoRefresh();
            } else {
                btn.innerHTML = '<i class="fas fa-sync-alt"></i><span>Auto Refresh: OFF</span>';
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-primary');
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
            }
        }
        
        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            document.getElementById('lastUpdate').textContent = `Last updated: ${timeString}`;
            document.getElementById('lastUpdateHeader').textContent = `Last updated: ${timeString}`;
        }
        
        // Analyze symbol
        function analyzeSymbol() {
            const input = document.getElementById('symbolInput');
            if (input.value.trim()) {
                currentSymbol = input.value.trim().toUpperCase();
                loadAllData();
                updateLastUpdateTime();
            }
        }
        
        // Quick analyze
        function quickAnalyze(symbol) {
            currentSymbol = symbol;
            document.getElementById('symbolInput').value = symbol;
            loadAllData();
            updateLastUpdateTime();
        }
        
        // Set timeframe
        function setTimeframe(timeframe) {
            // Update active button
            document.querySelectorAll('.timeframe-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentTimeframe = timeframe;
            loadChartData();
            updateLastUpdateTime();
        }

            updateLastUpdateTime();
        }
        
        // Run screener
        function runScreener() {
            const container = document.getElementById('smartMoneyScreener');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mb-4"></div>
                    <p class="text-gray-400">Scanning markets for opportunities...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                const opportunities = [
                    { symbol: 'BTC/USDT', composite_signal: 'BULLISH', confidence: 'HIGH', smart_money_score: 0.85, agreement_score: 0.78 },
                    { symbol: 'ETH/USDT', composite_signal: 'BULLISH', confidence: 'MEDIUM', smart_money_score: 0.65, agreement_score: 0.62 },
                    { symbol: 'SOL/USDT', composite_signal: 'NEUTRAL', confidence: 'LOW', smart_money_score: 0.42, agreement_score: 0.35 },
                    { symbol: 'AVAX/USDT', composite_signal: 'BEARISH', confidence: 'MEDIUM', smart_money_score: -0.55, agreement_score: 0.68 }
                ];
                
                let html = '<div class="space-y-4">';
                opportunities.forEach((opp, index) => {
                    const signalClass = opp.composite_signal === 'BULLISH' ? 'text-green-400' : 
                                      opp.composite_signal === 'BEARISH' ? 'text-red-400' : 'text-gray-400';
                    
                    html += `
                        <div class="border border-slate-700 rounded-xl p-4 hover:bg-slate-800 transition-all cursor-pointer"
                             onclick="quickAnalyze('${opp.symbol}')">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <span class="font-bold text-lg text-white">${opp.symbol}</span>
                                    <span class="ml-2 text-sm text-gray-400">#${index + 1}</span>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold ${signalClass}">${opp.composite_signal}</div>
                                    <div class="text-xs text-gray-400">${opp.confidence} Confidence</div>
                                </div>
                            </div>
                            <div class="flex justify-between text-sm text-gray-400">
                                <span>Score: ${opp.smart_money_score}</span>
                                <span>Agreement: ${Math.round(opp.agreement_score * 100)}%</span>
                            </div>
                            <div class="mt-3 w-full bg-slate-700 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-400 to-purple-600 h-2 rounded-full" 
                                     style="width: ${Math.abs(opp.smart_money_score) * 100}%"></div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                container.innerHTML = html;
            }, 1500);
        }
        
        // Load chart data
        function loadChartData() {
            const container = document.getElementById('priceChart');
            container.innerHTML = `
                <div class="flex items-center justify-center h-full bg-slate-800">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                        <p class="text-gray-400">Loading chart data for ${currentSymbol}...</p>
                    </div>
                </div>
            `;
            
            // Reinitialize chart after a delay
            setTimeout(initializeChart, 1000);
        }
        
        // Load smart money analysis
        function loadSmartMoneyAnalysis() {
            const container = document.getElementById('smartMoneyAnalysis');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-orange-500 mb-3"></div>
                    <p class="text-gray-400">Analyzing smart money activity...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                const analysis = {
                    composite_signal: 'BULLISH',
                    confidence: 'HIGH',
                    agreement_score: 0.82,
                    options_signal: 'BULLISH',
                    insider_signal: 'NEUTRAL',
                    institutional_signal: 'BULLISH',
                    recommendation: 'Strong buy signal with high confidence from multiple smart money indicators'
                };
                
                const html = `
                    <div class="space-y-5">
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between p-4 bg-gradient-to-r from-orange-900 to-amber-900 rounded-xl border border-orange-800">
                            <div>
                                <div class="text-sm text-orange-400 font-medium">Composite Signal</div>
                                <div class="text-2xl font-bold text-orange-300 mt-1">${analysis.composite_signal}</div>
                            </div>
                            <div class="mt-3 sm:mt-0">
                                <div class="text-sm text-orange-400">Confidence</div>
                                <div class="text-lg font-bold text-orange-300">${analysis.confidence}</div>
                            </div>
                            <div class="mt-3 sm:mt-0">
                                <div class="text-sm text-orange-400">Agreement</div>
                                <div class="text-lg font-bold text-orange-300">${Math.round(analysis.agreement_score * 100)}%</div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <div class="bg-green-900 bg-opacity-30 p-4 rounded-xl border border-green-800">
                                <div class="text-sm text-green-400 font-medium">Options Flow</div>
                                <div class="text-lg font-bold text-green-300 mt-1">${analysis.options_signal}</div>
                            </div>
                            <div class="bg-blue-900 bg-opacity-30 p-4 rounded-xl border border-blue-800">
                                <div class="text-sm text-blue-400 font-medium">Insider Trading</div>
                                <div class="text-lg font-bold text-blue-300 mt-1">${analysis.insider_signal}</div>
                            </div>
                            <div class="bg-purple-900 bg-opacity-30 p-4 rounded-xl border border-purple-800">
                                <div class="text-sm text-purple-400 font-medium">Institutional Flow</div>
                                <div class="text-lg font-bold text-purple-300 mt-1">${analysis.institutional_signal}</div>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-blue-900 bg-opacity-30 rounded-xl border border-blue-800">
                            <div class="text-sm text-blue-400 font-medium mb-2">Recommendation</div>
                            <p class="text-blue-200">${analysis.recommendation}</p>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }, 1200);
        }
        
        // Load advanced patterns
        function loadAdvancedPatterns() {
            const container = document.getElementById('advancedPatterns');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mb-3"></div>
                    <p class="text-gray-400">Scanning for chart patterns...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                const patterns = [
                    { pattern_type: 'Bullish Flag', signal: 'bullish', confidence: 0.85, description: 'Price consolidating in a bullish flag pattern with strong volume', target_price: 32500 },
                    { pattern_type: 'Double Bottom', signal: 'bullish', confidence: 0.72, description: 'Classic reversal pattern forming with increasing volume', target_price: 34000 },
                    { pattern_type: 'Head and Shoulders', signal: 'bearish', confidence: 0.68, description: 'Potential reversal pattern with neckline at $30,500', target_price: 29500 }
                ];
                
                if (patterns.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No Patterns Found</h3>
                            <p>No significant chart patterns detected at this time</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="space-y-4">';
                patterns.forEach(pattern => {
                    const badgeClass = pattern.signal === 'bullish' ? 'pattern-bullish' : 
                                      pattern.signal === 'bearish' ? 'pattern-bearish' : 'pattern-neutral';
                    
                    html += `
                        <div class="border border-slate-700 rounded-xl p-4 hover:bg-slate-800 transition-all">
                            <div class="flex justify-between items-start mb-3">
                                <h4 class="font-bold text-white">${pattern.pattern_type}</h4>
                                <div class="flex items-center space-x-2">
                                    <span class="pattern-badge ${badgeClass}">${pattern.signal.toUpperCase()}</span>
                                    <span class="text-sm text-gray-400 font-medium">${Math.round(pattern.confidence * 100)}%</span>
                                </div>
                            </div>
                            <p class="text-sm text-gray-300 mb-3">${pattern.description}</p>
                            ${pattern.target_price ? `
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-bullseye text-gray-500 mr-2"></i>
                                    <span class="text-gray-400">Target: </span>
                                    <span class="font-medium text-white ml-1">$${pattern.target_price.toLocaleString()}</span>
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                html += '</div>';
                
                container.innerHTML = html;
                
                // Update pattern metrics
                updatePatternMetrics(patterns);
            }, 1000);
        }
        
        // Update pattern metrics
        function updatePatternMetrics(patterns) {
            const total = patterns.length;
            const bullish = patterns.filter(p => p.signal === 'bullish').length;
            const bearish = patterns.filter(p => p.signal === 'bearish').length;
            
            document.getElementById('patternCount').textContent = total;
            document.getElementById('patternBreakdown').textContent = `${bullish} Bullish, ${bearish} Bearish`;
            document.getElementById('bullishPatternCount').textContent = bullish;
            document.getElementById('bearishPatternCount').textContent = bearish;
            
            // Update progress bars
            if (total > 0) {
                document.getElementById('bullishPatternBar').style.width = `${(bullish / total) * 100}%`;
                document.getElementById('bearishPatternBar').style.width = `${(bearish / total) * 100}%`;
            }
        }
        
        // Load market data
        function loadMarketData() {
            const container = document.getElementById('marketData');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500 mb-3"></div>
                    <p class="text-gray-400">Gathering market data...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                const data = {
                    technical_score: 0.75,
                    onchain_score: 0.68,
                    sentiment_score: 0.52,
                    volume_score: 0.81,
                    risk_level: 'MEDIUM',
                    entry_recommendation: 'Consider entering long positions with tight stop-loss'
                };
                
                const html = `
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-blue-900 bg-opacity-30 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-blue-400 font-medium">Technical</span>
                                    <span class="text-lg font-bold text-blue-300">${data.technical_score.toFixed(2)}</span>
                                </div>
                                <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: ${data.technical_score * 100}%"></div>
                                </div>
                            </div>
                            <div class="bg-purple-900 bg-opacity-30 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-purple-400 font-medium">On-Chain</span>
                                    <span class="text-lg font-bold text-purple-300">${data.onchain_score.toFixed(2)}</span>
                                </div>
                                <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-purple-600 h-2 rounded-full" style="width: ${data.onchain_score * 100}%"></div>
                                </div>
                            </div>
                            <div class="bg-orange-900 bg-opacity-30 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-orange-400 font-medium">Sentiment</span>
                                    <span class="text-lg font-bold text-orange-300">${data.sentiment_score.toFixed(2)}</span>
                                </div>
                                <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-orange-600 h-2 rounded-full" style="width: ${data.sentiment_score * 100}%"></div>
                                </div>
                            </div>
                            <div class="bg-green-900 bg-opacity-30 p-4 rounded-xl">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm text-green-400 font-medium">Volume</span>
                                    <span class="text-lg font-bold text-green-300">${data.volume_score.toFixed(2)}</span>
                                </div>
                                <div class="mt-2 w-full bg-slate-700 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: ${data.volume_score * 100}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center p-4 bg-slate-800 rounded-xl">
                            <span class="text-gray-300 font-medium">Risk Level</span>
                            <span class="font-bold ${data.risk_level === 'LOW' ? 'text-green-400' : data.risk_level === 'HIGH' ? 'text-red-400' : 'text-yellow-400'}">
                                ${data.risk_level}
                            </span>
                        </div>
                        
                        <div class="p-4 bg-gradient-to-r from-blue-900 to-indigo-900 rounded-xl border border-blue-800">
                            <div class="text-sm text-blue-400 font-medium mb-2">Entry Recommendation</div>
                            <p class="text-blue-200">${data.entry_recommendation}</p>
                        </div>
                    </div>
                `;
                
                container.innerHTML = html;
            }, 800);
        }
        
        // Load active trades
        function loadActiveTrades() {
            const container = document.getElementById('activeTradesDetail');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-green-500 mb-3"></div>
                    <p class="text-gray-400">Loading active trades...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                // In a real implementation, this would come from the Freqtrade API
                const trades = [
                    {
                        pair: 'BTC/USDT',
                        side: 'BUY',
                        amount: 0.25,
                        open_rate: 31250.50,
                        current_rate: 31875.25,
                        profit_pct: 2.0,
                        profit_abs: 312.38,
                        open_date: '2025-08-07T10:30:00Z',
                        strategy: 'MultiSignalStrategy',
                        stop_loss: 30500.00
                    }
                ];
                
                if (trades.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-wallet"></i>
                            <h3>No Active Trades</h3>
                            <p>Waiting for trading signals to execute</p>
                        </div>
                    `;
                    document.getElementById('activeTradesCount').textContent = '0';
                    document.getElementById('tradesProfit').textContent = '$0.00 P&L';
                    document.getElementById('tradesProfit').className = 'text-xs text-gray-400';
                    document.getElementById('tradeCountBadge').textContent = '0 trades';
                    return;
                }
                
                // Update header metrics
                const totalProfit = trades.reduce((sum, trade) => sum + trade.profit_abs, 0);
                document.getElementById('activeTradesCount').textContent = trades.length;
                document.getElementById('tradesProfit').textContent = `${totalProfit >= 0 ? '+' : ''}$${Math.abs(totalProfit).toFixed(2)} P&L`;
                document.getElementById('tradesProfit').className = `text-xs ${totalProfit >= 0 ? 'text-green-400' : 'text-red-400'}`;
                document.getElementById('tradeCountBadge').textContent = `${trades.length} ${trades.length === 1 ? 'trade' : 'trades'}`;
                
                // Update profitability bar
                const profitability = totalProfit >= 0 ? 50 + Math.min(50, totalProfit / 100) : 50 - Math.min(50, Math.abs(totalProfit) / 100);
                document.getElementById('profitabilityBar').style.width = `${Math.max(0, Math.min(100, profitability))}%`;
                
                let html = '<div class="space-y-4">';
                trades.forEach(trade => {
                    const profitClass = trade.profit_pct >= 0 ? 'text-green-400' : 'text-red-400';
                    const profitBgClass = trade.profit_pct >= 0 ? 'bg-green-900 bg-opacity-30 border-green-800' : 'bg-red-900 bg-opacity-30 border-red-800';
                    
                    html += `
                        <div class="border rounded-xl p-4 transition-all ${profitBgClass}">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-bold text-lg text-white">${trade.pair}</h4>
                                    <p class="text-sm text-gray-400">${trade.side} â€¢ ${parseFloat(trade.amount).toFixed(4)}</p>
                                    <p class="text-xs text-gray-500 mt-1">Entry: $${parseFloat(trade.open_rate).toFixed(2)}</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-lg ${profitClass}">
                                        ${trade.profit_pct >= 0 ? '+' : ''}${trade.profit_pct.toFixed(2)}%
                                    </p>
                                    <p class="text-sm font-medium ${profitClass}">
                                        ${trade.profit_abs >= 0 ? '+' : ''}$${Math.abs(trade.profit_abs).toFixed(2)}
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex justify-between text-xs text-gray-400 mt-3 pt-3 border-t border-slate-700">
                                <span>Strategy: ${trade.strategy}</span>
                                <span>SL: $${parseFloat(trade.stop_loss).toFixed(2)}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                container.innerHTML = html;
            }, 600);
        }
        
        // Load recent signals
        function loadRecentSignals() {
            const container = document.getElementById('recentSignals');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-yellow-500 mb-3"></div>
                    <p class="text-gray-400">Loading recent signals...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                const signals = [
                    { pair: 'BTC/USDT', signal_type: 'BUY', composite_score: 0.78, timestamp: '2025-08-07T14:30:00Z' },
                    { pair: 'ETH/USDT', signal_type: 'BUY', composite_score: 0.65, timestamp: '2025-08-07T13:45:00Z' },
                    { pair: 'SOL/USDT', signal_type: 'SELL', composite_score: -0.52, timestamp: '2025-08-07T12:15:00Z' }
                ];
                
                if (signals.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-bolt"></i>
                            <h3>No Recent Signals</h3>
                            <p>Waiting for strategy signals to generate</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="space-y-3">';
                signals.forEach(signal => {
                    const signalClass = signal.signal_type === 'BUY' ? 'text-green-400 bg-green-900 bg-opacity-30' : 'text-red-400 bg-red-900 bg-opacity-30';
                    
                    html += `
                        <div class="flex items-center justify-between p-3 border border-slate-700 rounded-lg hover:bg-slate-800 transition-all">
                            <div class="flex items-center">
                                <span class="font-medium text-white">${signal.pair}</span>
                                <span class="ml-3 px-2 py-1 text-xs font-bold rounded-full ${signalClass}">
                                    ${signal.signal_type}
                                </span>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-white">${signal.composite_score.toFixed(3)}</div>
                                <div class="text-xs text-gray-400">
                                    ${new Date(signal.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                container.innerHTML = html;
            }, 500);
        }
        
        // Load trade logic
        function loadTradeLogic() {
            const container = document.getElementById('tradeLogic');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-purple-500 mb-3"></div>
                    <p class="text-gray-400">Analyzing trade logic...</p>
                </div>
            `;
            
            // Simulate API call
            setTimeout(function() {
                const decisions = [
                    {
                        pair: 'BTC/USDT',
                        final_decision: 'BUY',
                        composite_score: 0.78,
                        technical_score: 0.82,
                        onchain_score: 0.65,
                        sentiment_score: 0.58,
                        timestamp: '2025-08-07T14:30:00Z',
                        position_size: 0.25,
                        market_regime: 'Trending Bullish',
                        reasoning: 'Strong bullish momentum confirmed by RSI divergence, increasing on-chain activity, and positive sentiment across social platforms.',
                        technical_reasoning: 'RSI showing bullish divergence with price, MACD crossing above signal line, and price breaking above key resistance level.',
                        onchain_reasoning: 'Whale accumulation detected with significant inflows to major exchanges, stablecoin supply increasing on trading platforms.',
                        sentiment_reasoning: 'Positive sentiment across Twitter and Reddit with increasing mentions and bullish ratio above 70%.'
                    }
                ];
                
                if (decisions.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-brain"></i>
                            <h3>No Trade Logic Available</h3>
                            <p>Waiting for trading decisions to be generated</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="space-y-5">';
                decisions.forEach(decision => {
                    const scoreColor = decision.composite_score > 0.5 ? 'text-green-400' : 
                                     decision.composite_score < -0.5 ? 'text-red-400' : 'text-gray-400';
                    
                    html += `
                        <div class="border border-slate-700 rounded-xl p-5 hover:bg-slate-800 transition-all">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 mb-4">
                                <div class="flex items-center">
                                    <span class="font-bold text-xl text-white">${decision.pair}</span>
                                    <span class="ml-3 px-3 py-1 text-sm font-bold rounded-full bg-gradient-to-r from-purple-900 to-indigo-900 text-purple-300">
                                        ${decision.final_decision}
                                    </span>
                                </div>
                                <div class="flex items-center">
                                    <div class="text-center mr-4">
                                        <div class="text-sm text-gray-400">Score</div>
                                        <div class="font-bold text-lg ${scoreColor}">${decision.composite_score.toFixed(3)}</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-sm text-gray-400">Position</div>
                                        <div class="font-bold text-lg text-white">${(decision.position_size * 100).toFixed(1)}%</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Signal Breakdown -->
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-4">
                                <div class="bg-blue-900 bg-opacity-30 p-3 rounded-lg">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium text-blue-400">Technical</span>
                                        <span class="text-sm font-bold text-blue-300">${decision.technical_score.toFixed(2)}</span>
                                    </div>
                                    <div class="w-full bg-slate-700 rounded-full h-1.5">
                                        <div class="bg-blue-600 h-1.5 rounded-full" style="width: ${Math.abs(decision.technical_score) * 100}%"></div>
                                    </div>
                                </div>
                                <div class="bg-purple-900 bg-opacity-30 p-3 rounded-lg">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium text-purple-400">On-Chain</span>
                                        <span class="text-sm font-bold text-purple-300">${decision.onchain_score.toFixed(2)}</span>
                                    </div>
                                    <div class="w-full bg-slate-700 rounded-full h-1.5">
                                        <div class="bg-purple-600 h-1.5 rounded-full" style="width: ${Math.abs(decision.onchain_score) * 100}%"></div>
                                    </div>
                                </div>
                                <div class="bg-orange-900 bg-opacity-30 p-3 rounded-lg">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-sm font-medium text-orange-400">Sentiment</span>
                                        <span class="text-sm font-bold text-orange-300">${decision.sentiment_score.toFixed(2)}</span>
                                    </div>
                                    <div class="w-full bg-slate-700 rounded-full h-1.5">
                                        <div class="bg-orange-600 h-1.5 rounded-full" style="width: ${Math.abs(decision.sentiment_score) * 100}%"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Reasoning -->
                            <div class="space-y-3">
                                <div>
                                    <div class="text-sm font-medium text-gray-300 mb-1">Overall Reasoning</div>
                                    <p class="text-sm text-gray-400">${decision.reasoning}</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <div class="bg-blue-900 bg-opacity-30 p-3 rounded-lg">
                                        <div class="text-sm font-medium text-blue-400 mb-1">Technical</div>
                                        <p class="text-xs text-blue-300">${decision.technical_reasoning}</p>
                                    </div>
                                    <div class="bg-purple-900 bg-opacity-30 p-3 rounded-lg">
                                        <div class="text-sm font-medium text-purple-400 mb-1">On-Chain</div>
                                        <p class="text-xs text-purple-300">${decision.onchain_reasoning}</p>
                                    </div>
                                    <div class="bg-orange-900 bg-opacity-30 p-3 rounded-lg">
                                        <div class="text-sm font-medium text-orange-400 mb-1">Sentiment</div>
                                        <p class="text-xs text-orange-300">${decision.sentiment_reasoning}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t border-slate-700 flex justify-between items-center">
                                <span class="text-xs text-gray-500">Market Regime: ${decision.market_regime}</span>
                                <span class="text-xs text-gray-500">${new Date(decision.timestamp).toLocaleString()}</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                
                container.innerHTML = html;
            }, 900);
        }
        
        // Utility functions
        function getSignalColor(signal) {
            switch(signal) {
                case 'BULLISH': return 'text-green-400';
                case 'BEARISH': return 'text-red-400';
                default: return 'text-gray-400';
            }
        }
        
        function getScoreColor(score) {
            if (score > 0.5) return 'text-green-400';
            if (score < -0.5) return 'text-red-400';
            return 'text-gray-400';
        }
        
        function getRiskColor(risk) {
            switch(risk) {
                case 'LOW': return 'text-green-400';
                case 'HIGH': return 'text-red-400';
                default: return 'text-yellow-400';
            }
        }
        
        // Filter patterns
        function filterPatterns(type) {
            // Update active filter button
            document.querySelectorAll('.timeframe-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // In a real implementation, this would filter the patterns
            console.log('Filtering patterns by:', type);
        }
    </script>
</body>
</html>